### Base Objects

Boiler:
  HotWater:
    Base: &BoilerHotWater
        Fields:
          name: '{} Boiler'
          boiler_water_inlet_node_name: '{} HW Inlet'
          boiler_water_outlet_node_name: '{} HW Outlet'
          boiler_flow_mode: ConstantFlow
        Connectors:
          HotWaterLoop:
            Inlet: boiler_water_inlet_node_name
            Outlet: boiler_water_outlet_node_name
          CondenserWaterLoop:
            Inlet: boiler_water_inlet_node_name
            Outlet: boiler_water_outlet_node_name

Chiller:
  Electric:
    EIR:
      Base: &ChillerElectricEIR
        Fields:
          name: '{}'
          chilled_water_inlet_node_name: '{} Chiller ChW Inlet'
          chilled_water_outlet_node_name: '{} Chiller ChW Outlet'
          condenser_inlet_node_name: '{} Chiller Cnd Inlet'
          condenser_outlet_node_name: '{} Chiller Cnd Outlet'
          chiller_flow_mode: ConstantFlow
          cooling_capacity_function_of_temperature_curve_name: 'Chiller RecipCapFT'
          electric_input_to_cooling_output_ratio_function_of_part_load_ratio_curve_name: 'Chiller RecipEIRFPLR'
          electric_input_to_cooling_output_ratio_function_of_temperature_curve_name: 'Chiller RecipEIRFT'
          total_cooling_capacity_function_of_temperature_curve_name: 'Chiller RecipCapFT'
          reference_chilled_water_flow_rate: Autosize
          reference_condenser_fluid_flow_rate: Autosize
        Connectors:
          ChilledWaterLoop:
            Inlet: chilled_water_inlet_node_name
            Outlet: chilled_water_outlet_node_name
          CondenserWAterLoop:
            Inlet: condenser_inlet_node_name
            Outlet: condenser_outlet_node_name

Coil:
  Cooling:
    Water:
      Fields: &CoilCoolingFields
        name: '{} Cooling Coil'
        air_inlet_node_name: '{} Cooling Coil Inlet'
        air_outlet_node_name: '{} Cooling Coil Outlet'
        water_inlet_node_name: '{} Cooling Coil Chw Inlet'
        water_outlet_node_name: '{} Cooling Coil Chw Outlet'
      Connectors: &CoilCoolingConnectors
        Air:
          Inlet: air_inlet_node_name
          Outlet: air_outlet_node_name
        ChilledWaterLoop:
          Inlet: water_inlet_node_name
          Outlet: water_outlet_node_name
      Base: &CoilCoolingWater
        Fields:
          << : *CoilCoolingFields
        Connectors:
          << : *CoilCoolingConnectors
      DetailedGeometry:
        Fields:
          << : *CoilCoolingFields
        Connectors:
          << : *CoilCoolingConnectors
  Heating:
    Fields: &CoilHeatingFields
      name: '{} Heating Coil'
      air_inlet_node_name: '{} Heating Coil Inlet'
      air_outlet_node_name: '{} Heating Coil Outlet'
    Connectors: &CoilHeatingConnectors
      Air:
        Inlet: air_inlet_node_name
        Outlet: air_outlet_node_name
    Electric:
      Fields:
      Connectors:
      Base: &CoilHeatingElectric
        Fields:
          <<: *CoilHeatingFields
        Connectors:
          <<: *CoilHeatingConnectors
    Water:
      Fields: &CoilHeatingWaterFields
        << : *CoilHeatingFields
        water_inlet_node_name: '{} Heating Coil Hw Inlet'
        water_outlet_node_name: '{} Heating Coil Hw Outlet'
        rated_inlet_air_temperature: 16.6 # todo_eo error messages without these fields
        rated_inlet_water_temperature: 82.2
        rated_outlet_air_temperature: 32.2
        rated_outlet_water_temperature: 71.1
        rated_ratio_for_air_and_water_convection: 0.5
        u_factor_times_area_value: Autosize
        performance_input_method: UFactorTimesAreaAndDesignWaterFlowRate
        rated_capacity: Autosize
      Connectors: &CoilHeatingWaterConnectors
        << : *CoilHeatingConnectors
        HotWaterLoop:
          Inlet: water_inlet_node_name
          Outlet: water_outlet_node_name
      Base: &CoilHeatingWater
        Fields:
          <<: *CoilHeatingWaterFields
        Connectors:
          <<: *CoilHeatingWaterConnectors

CoolingTower:
  SingleSpeed:
    Base: &CoolingTowerSingleSpeed
      Fields:
        name: '{} Tower'
        water_inlet_node_name: '{} CndW Inlet'
        water_outlet_node_name: '{} CndW Outlet'
        outdoor_air_inlet_node_name: '{} Outdoor Air Inlet Node Name'
        design_air_flow_rate: Autosize
        design_water_flow_rate: Autosize
        design_u_factor_times_area_value: Autosize
        blowdown_calculation_mode: "ConcentrationRatio"
        blowdown_concentration_ratio: 3
        capacity_control: "FanCycling"
        design_fan_power: "Autosize"
        drift_loss_percent: 0.008
        evaporation_loss_mode: "SaturatedExit"
        free_convection_capacity: "Autocalculate"
        free_convection_regime_air_flow_rate: "Autocalculate"
        free_convection_regime_u_factor_times_area_value: "Autocalculate"
        performance_input_method: "UFactorTimesAreaAndDesignWaterFlowRate"
      Connectors:
        CondenserWaterLoop:
          Inlet: water_inlet_node_name
          Outlet: water_outlet_node_name

Fan:
  Fields: &FanFields
    motor_efficiency: 0.9
    maximum_flow_rate: Autosize
  Connectors: &FanConnectors
    Air:
      Inlet: air_inlet_node_name
      Outlet: air_outlet_node_name
  VariableVolume:
    Base: &FanVariableVolume
      Fields:
        name: '{} Supply Fan'
        << : *FanFields
        air_inlet_node_name: '{} Supply Fan Inlet'
        air_outlet_node_name: '{} Supply Fan Outlet'
        fan_power_coefficient_1: 0.35071223
        fan_power_coefficient_2: 0.30850535
        fan_power_coefficient_3: -0.54137364
        fan_power_coefficient_4: 0.87198823
        fan_power_coefficient_5: 0
        fan_power_minimum_flow_fraction: 0.25
        fan_power_minimum_flow_rate_input_method: "Fraction"
        fan_total_efficiency: 0.7
      Connectors:
        << : *FanConnectors

OutdoorAir:Mixer: # structure might be unnecessary but is being used for example
  Fields: &OutdoorAirMixerFields
    name: '{} OA Mixing Box'
    mixed_air_node_name: '{} Mixed Air Outlet'
    outdoor_air_stream_node_name: '{} Outside Air Inlet' #will be overridden
    relief_air_stream_node_name: '{} Relief Air Outlet'
    return_air_stream_node_name: '{} Air Loop Inlet'
  Connectors: &OutdoorAirMixersConnectors
    Air:
      Inlet: outdoor_air_stream_node_name
      Outlet: mixed_air_node_name
  Base: &OutdoorAirMixer
      Fields:
        << : *OutdoorAirMixerFields
      Connectors:
        << : *OutdoorAirMixersConnectors

Pipe:
  Adiabatic:
    Base:
      Pipe:Adiabatic:
        Fields:
          name: '{} Pipe'
          inlet_node_name: '{} Pipe Inlet'
          outlet_node_name: '{} Pipe Outlet'
        Connectors: &PipeAdiabaticConnectors
          ChilledWaterLoop:
            Inlet: inlet_node_name
            Outlet: outlet_node_name
          CondenserWaterLoop:
            Inlet: inlet_node_name
            Outlet: outlet_node_name
          HotWaterLoop:
            Inlet: inlet_node_name
            Outlet: outlet_node_name
    SuppyInlet:
      Pipe:Adiabatic:
        Fields:
          name: '{} Demand Inlet Pipe'
          inlet_node_name: '{} Demand Inlet'
          outlet_node_name: '{} Demand Inlet Pipe Outlet'
        Connectors:
          <<: *PipeAdiabaticConnectors
    SupplyOutlet:
      Pipe:Adiabatic:
        Fields:
          name: '{} Demand Outlet Pipe'
          inlet_node_name: '{} Demand Outlet Pipe Inlet'
          outlet_node_name: '{} Demand Outlet'
        Connectors:
          <<: *PipeAdiabaticConnectors

Pump:
  ConstantSpeed:
    Fields:
      name: '{} Pump'
      inlet_node_name: '{} Pump Inlet'
      outlet_node_name: '{} Pump Outlet'
  VariableSpeed:
    Fields:
      name: '{} Pump'
      inlet_node_name: '{} Pump Inlet'
      outlet_node_name: '{} Pump Outlet'

### Complex Objects
AirTerminal:
  SingleDuct:
    Fields: &AirTerminalSingleDuctFields
      maximum_air_flow_rate: 'Autosize'
      damper_air_outlet_node_name: '{} Damper Outlet'
      air_inlet_node_name: '{} Zone Equip Inlet'
      air_outlet_node_name: '{} Supply Inlet'
    Connectors:
      Air: &AirTerminalSingleDuctConnectorsAir
        Inlet: air_inlet_node_name
        Outlet: air_outlet_node_name
      Water: &AirTerminalSingleDuctConnectorsWater
        Inlet: water_inlet_node_name
        Outlet: water_outlet_node_name
    VAV:
      Reheat:
        Base: &AirTerminalSingleDuctVAVReheat
          AirTerminal:SingleDuct:VAV:Reheat:
            Fields:
              name: '{} VAV Reheat'
              <<: *AirTerminalSingleDuctFields
              reheat_coil_object_type: Coil:Heating:Water
              reheat_coil_name: '{} Reheat Coil'
            Connectors:
              Air: *AirTerminalSingleDuctConnectorsAir
          Coil:Heating:Water:
            Fields:
              <<: *CoilHeatingWaterFields
              name: '{} Reheat Coil'
              air_inlet_node_name: '{} Damper Outlet' # keys can be overridden like this
              air_outlet_node_name: '{} Supply Inlet'
            Connectors:
              Air: *AirTerminalSingleDuctConnectorsAir
              HotWaterLoop:
                <<: *AirTerminalSingleDuctConnectorsWater
                UseInBuildPath: false
      NoReheat:
        Base: &AirTerminalSingleDuctVAVNoReheat
          Fields:
            name: '{} VAV'
            <<: *AirTerminalSingleDuctFields
          Connectors:
            Air: *AirTerminalSingleDuctConnectorsAir

### Additional Equipment
Controller:
  WaterCoil:
    Base: &ControllerWaterCoil
      name: '{} Coil Controller'
      control_variable: Temperature
      actuator_variable: Flow
      maximum_actuated_flow: Autosize
      minimum_actuated_flow: 0
      controller_convergence_tolerance: Autosize
  OutdoorAir:
    Base: &ControllerOutdoorAir
      name: '{} OA Controller'
      relief_air_outlet_node_name:
        OutdoorAir:M.*: relief_air_stream_node_name
      return_air_node_name:
        OutdoorAir:Mixer: return_air_stream_node_name
      mixed_air_node_name:
        OutdoorAir:Mixer: mixed_air_node_name
      actuator_node_name:
        BuildPath:
          Location: 0
          ConnectorPath: Air
          ValueLocation: Inlet
      maximum_outdoor_air_flow_rate: Autosize
      minimum_outdoor_air_flow_rate: Autosize

DesignSpecification:
  OutdoorAir:
    Base: &DesignSpecificationOutdoorAir
      name: '{} SZ DSOA'
      Transitions:
        outdoor_air_method: outdoor_air_method
        outdoor_air_flow_rate_per_person: outdoor_air_flow_per_person
        outdoor_air_flow_rate_per_zone_floor_area: outdoor_air_flow_per_zone_floor_area
        outdoor_air_flow_rate_per_zone: outdoor_air_flow_per_zone
  ZoneAirDistribution:
    Base: &DesignSpecificationZoneAirDistribution
      name: '{} SZ DSZAD'
      zone_air_distribution_effectiveness_in_cooling_mode: 1
      zone_air_distribution_effectiveness_in_heating_mode: 1

Schedule:
  Compact:
    ALWAYS_VAL:
      name: 'HVACTemplate-Always{}'
      schedule_type_limits_name: "Any Number"
      data:
        - field: Through 12/31
        - field: For AllDays
        - field: Until 24:00
        - field: '{:.1f}'
    FanAvailSched:
      name: 'FanAvailSched'
      schedule_type_limits_name: "Fraction"
      data:
        - field: "Through: 12/31"
        - field: "For: WeekDays CustomDay1 CustomDay2"
        - field: "Until: 7:00"
        - field: 0.0
        - field: "Until: 21:00"
        - field: 1.0
        - field: "Until: 24:00"
        - field: 0.0
        - field: "For: Weekends Holiday"
        - field: "Until: 24:00"
        - field: 0.0
        - field: "For: SummerDesignDay"
        - field: "Until: 24:00"
        - field: 1.0
        - field: "For: WinterDesignDay"
        - field: "Until: 24:00"
        - field: 1.0

SetpointManagers:
  MixedAir:
    Cooling:
      SetpointManager:MixedAir: &SetpointManagerMixedAirCooling
        name: '{} Cooling Coil Air Temp Manager'
        control_variable: Temperature
        reference_setpoint_node_name:
          Fan:.*: air_outlet_node_name
        fan_inlet_node_name:
          Fan:.*: air_inlet_node_name
        fan_outlet_node_name:
          Fan:.*: air_outlet_node_name
        setpoint_node_or_nodelist_name: '{} Mixed Air Nodes'
    Heating:
      SetpointManager:MixedAir: &SetpointManagerMixedAirHeating
        name: '{} Heating Coil Air Temp Manager'
        control_variable: Temperature
        reference_setpoint_node_name: '{} Supply Path Inlet'
        fan_inlet_node_name:
          Fan:.*: air_inlet_node_name
        fan_outlet_node_name:
          Fan:.*: air_inlet_node_name
        setpoint_node_or_nodelist_name:
          Fan:.*: air_inlet_node_name
Sizing:
  Zone:
    Base: &SizingZone
      name: '{} Sizing Zone'
      cooling_design_air_flow_method: DesignDay
      heating_design_air_flow_method: DesignDay
      zone_cooling_design_supply_air_temperature: 12.8
      zone_cooling_design_supply_air_temperature_difference: 11.11
      zone_cooling_design_supply_air_humidity_ratio: 0.0085
      zone_heating_design_supply_air_temperature: 50.0
      zone_heating_design_supply_air_humidity_ratio: 0.008
      design_specification_outdoor_air_object_name:
        ^DesignSpecification:Outdoor.*: key
    Transitions: &SizingZoneTransitions
      zone_name: zone_or_zonelist_name
      zone_cooling_design_supply_air_humidity_ratio: zone_cooling_design_supply_air_humidity_ratio
      zone_cooling_design_supply_air_temperature: zone_cooling_design_supply_air_temperature
      zone_cooling_design_supply_air_temperature_input_method: zone_cooling_design_supply_air_temperature_input_method
      zone_heating_design_supply_air_temperature_input_method: zone_heating_design_supply_air_temperature_input_method
      zone_heating_design_supply_air_temperature: zone_heating_design_supply_air_temperature
      design_specification_outdoor_air_object_name_for_sizing: design_specification_outdoor_air_object_name
      design_specification_zone_air_distribution_object_name: design_specification_zone_air_distribution_object_name
      zone_heating_sizing_factor: zone_heating_sizing_factor
      zone_cooling_sizing_factor: zone_cooling_sizing_factor
  System:
    Base: &SizingSystem
      name: '{} Sizing System'
      airloop_name: '{}'
      central_cooling_capacity_control_method: OnOff
      preheat_design_temperature: 5.0
      preheat_design_humidity_ratio: 0.008
      precool_design_temperature: 11
      precool_design_humidity_ratio: 0.008
      central_cooling_design_supply_air_temperature: 12.8
      central_heating_design_supply_air_temperature: 10.0
      cooling_design_capacity_method: CoolingDesignCapacity
      heating_design_capacity_method: HeatingDesignCapacity
      system_outdoor_air_method: ZoneSum
    Transitions: &SizingSystemTransitions
  Plant:
    Base: &SizingPlant
      name: '{} Sizing Plant'
      plant_or_condenser_loop_name: '{} PlantLoop'
    Transitions:

ZoneControl:
  Thermostat:
    Base: &ZoneControlThermostat
      name: '{} Thermostat'

ZoneHVAC:
  AirDistributionUnit:
    Base: &ZoneHVACAirDistributionUnit
      name: '{} ATU'
      air_distribution_unit_outlet_node_name:
        ^AirTerminal:.*: air_outlet_node_name
      air_terminal_object_type:
        ^AirTerminal:.*: self
      air_terminal_name:
        ^AirTerminal:.*: key
  Baseboard:
    RadiantConvective:
      Water:
        Base: &ZoneHVACBaseboardRadiantConvectiveWaterBase
          name: '{} Baseboard Heat'
          inlet_node_name: '{} Baseboard HW Inlet'
          outlet_node_name: '{} Baseboard HW Outlet'
          maximum_water_flow_rate: Autosize
          fraction_radiant: 0
          heating_design_capacity: Autosize
  EquipmentList: &ZoneHVACEquipmentList
    name: '{} Equipment'
    load_distribution_scheme: SequentialLoad
    equipment:
      - zone_equipment_object_type:
          ^ZoneHVAC:.*: self
        zone_equipment_name: "{} ATU"
        zone_equipment_cooling_sequence: 1
        zone_equipment_heating_or_no_load_sequence: 1
  EquipmentConnections:
    Base: &ZoneHVACEquipmentConnections
      name: "{} Equipment Connections"
      zone_name: '{}'
      zone_conditioning_equipment_list_name:
        ZoneHVAC:EquipmentList: key
      zone_air_inlet_node_or_nodelist_name:
        ^AirTerminal:.*: air_outlet_node_name
      zone_air_node_name: '{} Zone Air Node'
      zone_return_air_node_or_nodelist_name: '{} Return Outlet'

#Non Option Tree Additional Equipment
AirLoopHVAC:
  Base:
    name: '{}'
    controller_list_name: '{} Controllers'
    availability_manager_list_name: '{} Availability Managers'
    branch_list_name: '{} Air Branches'
    design_supply_air_flow_rate: Autosize
    supply_side_inlet_node_name:
      OutdoorAir:Mixer: return_air_stream_node_name
    supply_side_outlet_node_names:
      BuildPath:
        Location: -1
        ConnectorPath: Air
        ValueLocation: Outlet
    demand_side_inlet_node_names: '{} Supply Path Inlet' #plenum and path objects need to be renamed to same value
    demand_side_outlet_node_names: '{} Return Air Outlet'
  ControllerList:
    Base:
      name: '{} Controllers'
  OutdoorAirSystem:
    Base: &AirLoopHVACOutdoorAirSystem
      name: '{} OA System'
      controller_list_name: '{} OA Controllers'
      outdoor_air_equipment_list_name:
        ^AirLoopHVAC:OutdoorAirSystem:EquipmentList: self
      availability_manager: '{} Availability Managers'
      supply_side_inlet_node_name:
        ^Controller:OutdoorAir: return_air_node_name
    EquipmentList:
      Base:
        name: '{} OA System Equipment'
  ReturnPath:
    Base:
      name: '{} Return Path'
      return_air_path_outlet_node_name:
        ^AirLoopHVAC:(ZoneMixer|ReturnPlenum): outlet_node_name
      components:
        - component_object_type:
            ^AirLoopHVAC:(ZoneMixer|ReturnPlenum): self
          component_name:
            ^AirLoopHVAC:(ZoneMixer|ReturnPlenum): key
  ReturnPlenum:
    Base:
      name: '{} Return Plenum'
      outlet_node_name: '{} Return Air Outlet'
  SupplyPath:
    Base:
      name: '{} Supply Path'
      supply_air_path_inlet_node_name:
        ^AirLoopHVAC:(ZoneSplitter|SupplyPlenum): inlet_node_name
      components:
        - component_object_type:
            ^AirLoopHVAC:(ZoneSplitter|SupplyPlenum): self
          component_name:
            ^AirLoopHVAC:(ZoneSplitter|SupplyPlenum): key
  SupplyPlenum:
    Base:
      name: '{} Supply Plenum'
      inlet_node_name: '{} Supply Path Inlet'
  ZoneSplitter:
    Base:
      name: '{} Zone Splitter'
      inlet_node_name: '{} Supply Path Inlet'
  ZoneMixer:
    Base:
      name: '{} Zone Mixer'
      outlet_node_name: '{} Return Air Outlet'

### Common Combinations
SystemConfiguration:
  WaterLoopBase: &SystemConfigurationWaterLoopBase
    - OutdoorAir:Mixer: *OutdoorAirMixer
    - Coil:Cooling:Water: *CoilCoolingWater
    - Coil:Heating:Water: *CoilHeatingWater
    - Fan:VariableVolume: *FanVariableVolume

### HVAC System Templates
HVACTemplate:
  Zone:
    VAV: &HVACTemplateZoneVAV
      BuildPath:
        - *AirTerminalSingleDuctVAVReheat
      Transitions:
        supply_air_maximum_flow_rate:
          AirTerminal:.*: maximum_air_flow_rate
        damper_heating_action:
          AirTerminal:.*: damper_heating_action
        zone_minimum_air_flow_input_method:
          AirTerminal:.*: zone_minimum_air_flow_input_method
  System:
    VAV: &HVACTemplateSystemVAV
      BuildPath: # path of airflow through components
        *SystemConfigurationWaterLoopBase
      Transitions: # values to transition from template to child objects {object_type: object_field_name}
        supply_fan_total_efficiency:
          Fan:.*: fan_total_efficiency
        system_availability_schedule_name:
          Fan:.*: availability_schedule_name
        supply_fan_delta_pressure:
          Fan:.*: pressure_rise
  Plant:
    Boiler: &HVACTemplatePlantBoiler
      BuildPath:
        - Boiler:HotWater: *BoilerHotWater
      Transitions:
        fuel_type:
          ^Boiler.*: fuel_type
        efficiency:
          ^Boiler.*: nominal_thermal_efficiency
        capacity:
          ^Boiler:.*: nominal_capacity
    Chiller: &HVACTemplatePlantChiller
      BuildPath:
        - Chiller:Electric:EIR: *ChillerElectricEIR
      Transitions:
        capacity:
          ^Chiller:.*: reference_capacity
        nominal_cop:
          ^Chiller:.*: reference_cop
        condenser_type:
          ^Chiller:.*: condenser_type
    ChilledWaterLoop: &HVACTemplatePlantChilledWaterLoop
      BuildPath:
    CondenserWaterLoop: &HVACTemplatePlantCondenserWaterLoop
      BuildPath:
    HotWaterLoop: &HVACTemplatePlantHotWaterLoop
      BuildPath:
    Tower: &HVACTemplatePlantTower
      BuildPath:
        - CoolingTower:SingleSpeed: *CoolingTowerSingleSpeed
      Transitions:
        high_speed_fan_power:
          ^CoolingTower:.*: design_fan_power

### Option Trees
OptionTree:
  HVACTemplate:
    Zone:
      VAV:
        Base: *HVACTemplateZoneVAV
#        RemoveElements:
#          reheat_coil_type:
#            HotWaterLoop:
#              ^Coil:Heating:.*:
#                Object: _ # necessary to preserve same structure as other actions
        ReplaceElements:
          reheat_coil_type:
            None:
              - '^AirTerminal:.*':
                  Object:
                    AirTerminal:SingleDuct:VAV:NoReheat: *AirTerminalSingleDuctVAVNoReheat
            Electric:
              - ^AirTerminal:.*:
                  Object:
                    AirTerminal:SingleDuct:VAV:Reheat:
                      <<: *AirTerminalSingleDuctVAVReheat
                      reheat_coil_type: Coil:Heating:Electric
              - ^Coil:Heating.*:
                  Object:
                    Coil:Heating:Electric:
                      Fields:
                        <<: *CoilHeatingFields
                        air_inlet_node_name: '{} Damper Outlet'
                        air_outlet_node_name: '{} Supply Inlet'
                      Connectors:
                        Air:
                          Inlet: '{} Damper Outlet'
                          Outlet: '{} Supply Inlet'
            Gas:
              - ^AirTerminal:.*:
                  Object:
                    AirTerminal:SingleDuct:VAV:Reheat:
                      <<: *AirTerminalSingleDuctVAVReheat
                      reheat_coil_type: Coil:Heating:Fuel
              - ^Coil:Heating.*:
                  Object:
                    Coil:Heating:Fuel:
                      Fields:
                        <<: *CoilHeatingFields
                        air_inlet_node_name: '{} Damper Outlet'
                        air_outlet_node_name: '{} Supply Inlet'
                      Connectors:
                        Air:
                          Inlet: '{} Damper Outlet'
                          Outlet: '{} Supply Inlet'
        InsertElements:
        AdditionalObjects:
          - ZoneHVAC:AirDistributionUnit: *ZoneHVACAirDistributionUnit
          - ZoneHVAC:EquipmentList:
              <<: *ZoneHVACEquipmentList
          - ZoneHVAC:EquipmentConnections:
              <<: *ZoneHVACEquipmentConnections
              zone_conditioning_equipment_list_name:
                ^ZoneHVAC:EquipmentList: key
              zone_air_inlet_node_or_nodelist_name:
                ^AirTerminal:.*: air_outlet_node_name
              zone_air_return_node_or_nodelist_name: '{} Return Outlet'
              Transitions:
                zone_name: zone_name
          - DesignSpecification:OutdoorAir:
              <<: *DesignSpecificationOutdoorAir
          - DesignSpecification:ZoneAirDistribution:
              <<: *DesignSpecificationZoneAirDistribution
          - Sizing:Zone:
              <<: *SizingZone
              Transitions:
                <<: *SizingZoneTransitions
        AdditionalTemplateObjects:
          template_thermostat_name:
            .*:
              - ZoneControl:Thermostat:
                  <<: *ZoneControlThermostat
                  Transitions:
                    zone_name: zone_or_zonelist_name
                    template_thermostat_name: control_1_name
          baseboard_heating_type:
            HotWater:
              - ZoneHVAC:Baseboard:RadiantConvective:Water: *ZoneHVACBaseboardRadiantConvectiveWaterBase
              - Branch:
                  name: '{} Baseboard Heat HW Branch'
                  components:
                    - component_object_type:
                        ^ZoneHVAC:Baseboard.*: self
                      component_name:
                        ^ZoneHVAC:Baseboard.*: key
                      component_inlet_node_name:
                        ^ZoneHVAC:Baseboard.*: inlet_node_name
                      component_outlet_node_name:
                        ^ZoneHVAC:Baseboard.*: outlet_node_name
              - ZoneHVAC:EquipmentList:
                  <<: *ZoneHVACEquipmentList
                  equipment:
                    - zone_equipment_object_type:
                        ^ZoneHVAC:AirDist*: self
                      zone_equipment_name: "{} ATU"
                      zone_equipment_cooling_sequence: 1
                      zone_equipment_heating_or_no_load_sequence: 1
                    - zone_equipment_object_type:
                        ^ZoneHVAC:Baseboard.*: self
                      zone_equipment_name: "{} Baseboard Heat"
                      zone_equipment_cooling_sequence: 2
                      zone_equipment_heating_or_no_load_sequence: 2
    System:
      VAV: # configuration to store options for altering a base build
        Base: *HVACTemplateSystemVAV
        RemoveElements: # Not sure if this is needed but it should be possible, probably using list.pop()
        ReplaceElements: # replace an existing element with something else
          heating_coil_type: # base path must have an object to replace for this to work
            None: None
            Electric:
              - ^Coil:Heating:.*:
                  Occurrence: 1
                  Object:
                    Coil:Heating:Electric: *CoilHeatingElectric # anchor/map reference to coil
                  FieldNameReplacement: '{} Electric'
        InsertElements: # Insert element before or after another element
          preheat_coil_type:
            Electric:
              - OutdoorAir:M.*:
                  Location: Before
                  Occurrence: 1
                  Object:
                    Coil:Heating:Electric:
                      Fields:
                        <<: *CoilHeatingFields
                        temperature_setpoint_node_name: '{} Heating Coil Outlet'
                      Connectors:
                        <<: *CoilHeatingConnectors
                  FieldNameReplacement: '{} Preheat Electric'
        AdditionalObjects:
          - SetpointManager:MixedAir:
              <<: *SetpointManagerMixedAirCooling
          - NodeList:
              name:
                ^SetpointManager:MixedAir: setpoint_node_or_nodelist_name
              nodes:
                - node_name:
                    ^Coil:Cooling:.*: air_outlet_node_name
                - node_name:
                    ^OutdoorAir:Mixer: mixed_air_node_name
          - Controller:OutdoorAir:
              <<: *ControllerOutdoorAir
              economizer_control_action_type: ModulateFlow
              Transitions:
                economizer_type: economizer_control_type
                economizer_lockout: lockout_type
          - OutdoorAir:NodeList:
              name: '{} Outdoor Air NodeList'
              nodes:
                - node_or_nodelist_name:
                    BuildPath:
                      Location: 0
                      ConnectorPath: Air
                      ValueLocation: Inlet
          - Sizing:System:
              <<: *SizingSystem
              Transitions: *SizingSystemTransitions
          - AvailabilityManager:NightCycle:
              name: '{} Availability'
              applicability_schedule_name: HVACTemplate-Always1.0
              fan_schedule_name: FanAvailSched
              Transitions:
                night_cycle_control: control_type
          - AvailabilityManagerAssignmentList: # this should be built in function
              name: '{} Availability Managers'
              managers:
                - availability_manager_name: '{} Availability'
                  availability_manager_object_type: "AvailabilityManager:NightCycle"
          - Schedule:Compact:
              name: FanAvailSched
          - Schedule:Compact:
              name: HVACTemplate-Always1.0
          - SetpointManager:Scheduled:
              name: '{} Cooling Supply Air Temp Manager'
              control_variable: Temperature
              setpoint_node_or_nodelist_name:
                BuildPath:
                  Location: -1
                  ConnectorPath: Air
                  ValueLocation: Outlet
              Transitions:
                cooling_coil_design_setpoint:
                  schedule_name: 'HVACTemplate-Always{}'
          - Schedule:Compact:
              Transitions:
                cooling_coil_design_setpoint:
                     name: 'HVACTemplate-Always{}'
          - SetpointManager:Scheduled:
              name: '{} Heating Supply Air Temp Manager'
              control_variable: Temperature
              setpoint_node_or_nodelist_name: '{} Supply Path Inlet'
              Transitions:
                heating_coil_design_setpoint:
                  schedule_name: 'HVACTemplate-Always{}'
          - Schedule:Compact:
              Transitions:
                heating_coil_design_setpoint:
                  name: 'HVACTemplate-Always{}'
          - SetpointManager:MixedAir:
              <<: *SetpointManagerMixedAirHeating
          - AirLoopHVAC:OutdoorAirSystem:
              <<: *AirLoopHVACOutdoorAirSystem
              outdoor_air_equipment_list_name: '{} OA System Equipment'
        AdditionalTemplateObjects: # template triggered objects
          cooling_coil_type:
            ChilledWater:
              - Controller:WaterCoil:
                  <<: *ControllerWaterCoil
                  name: '{} Cooling Coil Controller'
                  action: Reverse
                  sensor_node_name:
                    ^Coil:Cooling:Water: air_outlet_node_name
                  actuator_node_name:
                    ^Coil:Cooling:Water: water_inlet_node_name
          heating_coil_type:
            HotWater:
              - Controller:WaterCoil:
                  <<: *ControllerWaterCoil
                  name: '{} Heating Coil Controller'
                  action: Normal
                  sensor_node_name:
                    ^Coil:Heating:Water: air_outlet_node_name
                  actuator_node_name:
                    ^Coil:Heating:Water: water_inlet_node_name
          preheat_coil_type:
            .*:
              - SetpointManager:Scheduled:
                  name: '{} Preheat Coil Air Temp Manager'
                  control_variable: Temperature
                  setpoint_node_or_nodelist_name:
                    OutdoorAir:Mixer: outdoor_air_stream_node_name
                  schedule_name: HVACTemplate-Always5.0
                  Transitions:
                    preheat_coil_design_setpoint:
                      schedule_name: 'HVACTemplate-Always{}'
              - Schedule:Compact:
                  name: HVACTemplate-Always5.0
    Plant:
      Boiler:
        Base: *HVACTemplatePlantBoiler
        AdditionalObjects:
          - Curve:Quadratic:
              name: Main Boiler Efficiency Curve
              coefficient1_constant: 0.97
              coefficient2_x: 0.0633
              coefficient3_x_2: -0.0333
              maximum_value_of_x: 1.0
              minimum_value_of_x: 0.0
        AdditionalTemplateObjects:
          template_plant_loop_type:
            None:
              - Branch:
                  name: '{} Boiler HW Branch'
                  components:
                    - component_object_type:
                        Boiler.*: self
                      component_name:
                        Boiler.*: key
                      component_inlet_node_name:
                        Boiler.*: boiler_water_inlet_node_name
                      component_outlet_node_name:
                        Boiler.*: boiler_water_outlet_node_name
            HotWater:
              - Branch:
                  name: '{} Boiler HW Branch'
                  components:
                    - component_object_type:
                        Boiler.*: self
                      component_name:
                        Boiler.*: key
                      component_inlet_node_name:
                        Boiler.*: boiler_water_inlet_node_name
                      component_outlet_node_name:
                        Boiler.*: boiler_water_outlet_node_name
            MixedWater:
              - Branch:
                  name: '{} Boiler MW Branch'
                  components:
                    - component_object_type:
                        Boiler.*: self
                      component_name:
                        Boiler.*: key
                      component_inlet_node_name:
                        Boiler.*: boiler_water_inlet_node_name
                      component_outlet_node_name:
                        Boiler.*: boiler_water_outlet_node_name
      Chiller:
        Base: *HVACTemplatePlantChiller
        ReplaceElements:
        AdditionalObjects:
          - Branch:
              name: '{} ChW Branch'
              components:
                - component_object_type:
                    Chiller.*: self
                  component_name:
                    Chiller.*: key
                  component_inlet_node_name:
                    Chiller.*: chilled_water_inlet_node_name
                  component_outlet_node_name:
                    Chiller.*: chilled_water_outlet_node_name
          - Curve:Quadratic:
              name: Chiller RecipEIRFPLR
              coefficient1_constant: 0.088065
              coefficient2_x: 1.137742
              coefficient3_x_2: -0.225806
              maximum_value_of_x: 1
              minimum_value_of_x: 0
          - Curve:Quadratic:
              name: Chiller RecipCapFT
              coefficient1_constant: 0.507883
              coefficient2_x: 0.145228
              coefficient3_x_2: -0.00625644
              coefficient4_y: -0.0011178
              coefficient5_y_2: -0.0001296
              coefficient6_x_y: -0.00028188
              maximum_value_of_x: 10
              maximum_value_of_y: 35
              minimum_value_of_x: 5
              minimum_value_of_y: 24
          - Curve:Quadratic:
              name: Chiller RecipEIRFT
              coefficient1_constant: 1.03076
              coefficient2_x: -0.103536
              coefficient3_x_2: 0.00710208
              coefficient4_y: 0.0093186
              coefficient5_y_2: 0.00031752
              coefficient6_x_y: -0.00104328
              maximum_value_of_x: 10
              maximum_value_of_y: 35
              minimum_value_of_x: 5
              minimum_value_of_y: 24
        AdditionalTemplateObjects:
          condenser_type:
            WaterCooled:
              - Branch:
                  name: '{} CndW Branch'
                  components:
                    - component_object_type:
                        Chiller.*: self
                      component_name:
                        Chiller.*: key
                      component_inlet_node_name:
                        Chiller.*: condenser_inlet_node_name
                      component_outlet_node_name:
                        Chiller.*: condenser_outlet_node_name
              - HVACTemplate:Plant:CondenserWaterLoop:
                  ConnectorPath: CondenserWaterLoop
                  UniqueName: 'CondenserWaterLoop'
      ChilledWaterLoop:
        Base: *HVACTemplatePlantChilledWaterLoop
        AdditionalObjects:
          - Sizing:Plant:
              <<: *SizingPlant
              loop_type: Cooling
              loop_design_temperature_difference: 6.67
              Transitions:
                chilled_water_design_setpoint: design_loop_exit_temperature
          - Pipe:Adiabatic:
              name: '{} Supply Bypass Pipe'
              inlet_node_name: '{} Supply Bypass Inlet'
              outlet_node_name: '{} Supply Bypass Outlet'
          - Branch:
              name: '{} Supply Bypass Branch'
              components:
                - component_object_type: Pipe:Adiabatic
                  component_name: '{} Supply Bypass Pipe'
                  component_inlet_node_name: '{} Supply Bypass Inlet'
                  component_outlet_node_name: '{} Supply Bypass Outlet'
          - Pipe:Adiabatic:
              name: '{} Supply Outlet Pipe'
              inlet_node_name: '{} Supply Outlet Pipe Inlet'
              outlet_node_name: '{} Supply Outlet'
          - Branch:
              name: '{} Supply Outlet Branch'
              components:
                - component_object_type: Pipe:Adiabatic
                  component_name: '{} Supply Outlet Pipe'
                  component_inlet_node_name: '{} Supply Outlet Pipe Inlet'
                  component_outlet_node_name: '{} Supply Outlet'
          - Pipe:Adiabatic:
              name: '{} Demand Bypass Pipe'
              inlet_node_name: '{} Demand Bypass Inlet'
              outlet_node_name: '{} Demand Bypass Outlet'
          - Branch:
              name: '{} Demand Bypass Branch'
              components:
                - component_object_type: Pipe:Adiabatic
                  component_name: '{} Demand Bypass Pipe'
                  component_inlet_node_name: '{} Demand Bypass Inlet'
                  component_outlet_node_name: '{} Demand Bypass Outlet'
          - Pipe:Adiabatic:
              name: '{} Demand Outlet Pipe'
              inlet_node_name: '{} Demand Outlet Pipe Inlet'
              outlet_node_name: '{} Demand Outlet'
          - Branch:
              name: '{} Demand Outlet Branch'
              components:
                - component_object_type: Pipe:Adiabatic
                  component_name: '{} Demand Outlet Pipe'
                  component_inlet_node_name: '{} Demand Outlet Pipe Inlet'
                  component_outlet_node_name: '{} Demand Outlet'
        AdditionalTemplateObjects:
          chilled_water_pump_configuration:
            ConstantPrimaryNoSecondary:
              - Pump:ConstantSpeed:
                  name: '{} Supply Pump'
                  inlet_node_name: '{} Supply Inlet'
                  outlet_node_name: '{} Supply Inlet Pump Outlet'
                  design_flow_rate: Autosize
                  design_power_consumption: Autosize
                  pump_control_type: Intermittent
                  Transitions:
                    primary_chilled_water_pump_rated_head: design_pump_head
              - Branch:
                  name: '{} Supply Inlet Branch'
                  components:
                    - component_object_type: Pump:ConstantSpeed
                      component_name: '{} Supply Pump'
                      component_inlet_node_name: '{} Supply Inlet'
                      component_outlet_node_name: '{} Supply Inlet Pump Outlet'
              - Pipe:Adiabatic:
                  name: '{} Demand Inlet Pipe'
                  inlet_node_name: '{} Demand Inlet'
                  outlet_node_name: '{} Demand Inlet Pipe Outlet'
              - Branch:
                  name: '{} Demand Inlet Branch'
                  components:
                    - component_object_type: Pipe:Adiabatic
                      component_name: '{} Demand Inlet Pipe'
                      component_inlet_node_name: '{} Demand Inlet'
                      component_outlet_node_name: '{} Demand Inlet Pipe Outlet'
              - AvailabilityManager:LowTemperatureTurnOff:
                  name: '{} Availability Low Temp TurnOff'
                  sensor_node_name: '{} Outside Air Sensor'
                  Transitions:
                    chilled_water_design_setpoint: temperature
              - AvailabilityManagerAssignmentList: # this should be built in function
                  name: '{} Availability List'
                  managers:
                    - availability_manager_name: '{} Availability Low Temp TurnOff'
                      availability_manager_object_type: "AvailabilityManager:LowTemperatureTurnOff"
              - OutdoorAir:Node:
                  name: '{} Outside Air Sensor'
      CondenserWaterLoop:
        Base: *HVACTemplatePlantCondenserWaterLoop
        AdditionalObjects:
          - Sizing:Plant:
              <<: *SizingPlant
              loop_type: Condenser
              loop_design_temperature_difference: 5.6
              Transitions:
                condenser_water_design_setpoint: design_loop_exit_temperature
          - Pump:VariableSpeed:
              name: '{} Supply Pump'
              inlet_node_name: '{} Supply Inlet'
              outlet_node_name: '{} Supply Inlet Pump Outlet'
              design_flow_rate: Autosize
              design_power_consumption: Autosize
              pump_control_type: Intermittent
              Transitions:
                condenser_water_pump_rated_head: design_pump_head
          - Branch:
              name: '{} Supply Inlet Branch'
              components:
                - component_object_type: Pump:VariableSpeed
                  component_name: '{} Supply Pump'
                  component_inlet_node_name: '{} Supply Inlet'
                  component_outlet_node_name: '{} Supply Inlet Pump Outlet'
          - Pipe:Adiabatic:
              name: '{} Supply Bypass Pipe'
              inlet_node_name: '{} Supply Bypass Inlet'
              outlet_node_name: '{} Supply Bypass Outlet'
          - Branch:
              name: '{} Supply Bypass Branch'
              components:
                - component_object_type: Pipe:Adiabatic
                  component_name: '{} Supply Bypass Pipe'
                  component_inlet_node_name: '{} Supply Bypass Inlet'
                  component_outlet_node_name: '{} Supply Bypass Outlet'
          - Pipe:Adiabatic:
              name: '{} Supply Outlet Pipe'
              inlet_node_name: '{} Supply Outlet Pipe Inlet'
              outlet_node_name: '{} Supply Outlet'
          - Branch:
              name: '{} Supply Outlet Branch'
              components:
                - component_object_type: Pipe:Adiabatic
                  component_name: '{} Supply Outlet Pipe'
                  component_inlet_node_name: '{} Supply Outlet Pipe Inlet'
                  component_outlet_node_name: '{} Supply Outlet'
          - Pipe:Adiabatic:
              name: '{} Demand Inlet Pipe'
              inlet_node_name: '{} Demand Inlet'
              outlet_node_name: '{} Demand Inlet Pipe Outlet'
          - Branch:
              name: '{} Demand Inlet Branch'
              components:
                - component_object_type: Pipe:Adiabatic
                  component_name: '{} Demand Inlet Pipe'
                  component_inlet_node_name: '{} Demand Inlet'
                  component_outlet_node_name: '{} Demand Inlet Pipe Outlet'
          - Pipe:Adiabatic:
              name: '{} Demand Bypass Pipe'
              inlet_node_name: '{} Demand Bypass Inlet'
              outlet_node_name: '{} Demand Bypass Outlet'
          - Branch:
              name: '{} Demand Bypass Branch'
              components:
                - component_object_type: Pipe:Adiabatic
                  component_name: '{} Demand Bypass Pipe'
                  component_inlet_node_name: '{} Demand Bypass Inlet'
                  component_outlet_node_name: '{} Demand Bypass Outlet'
          - Pipe:Adiabatic:
              name: '{} Demand Outlet Pipe'
              inlet_node_name: '{} Demand Outlet Pipe Inlet'
              outlet_node_name: '{} Demand Outlet'
          - Branch:
              name: '{} Demand Outlet Branch'
              components:
                - component_object_type: Pipe:Adiabatic
                  component_name: '{} Demand Outlet Pipe'
                  component_inlet_node_name: '{} Demand Outlet Pipe Inlet'
                  component_outlet_node_name: '{} Demand Outlet'
          - Schedule:Compact:
              name: HVACTemplate-Always29.4
      HotWaterLoop:
        Base: *HVACTemplatePlantHotWaterLoop
        AdditionalObjects:
          - Sizing:Plant:
              <<: *SizingPlant
              loop_type: Heating
              loop_design_temperature_difference: 11
              Transitions:
                hot_water_design_setpoint: design_loop_exit_temperature
          - Pump:ConstantSpeed:
              name: '{} Supply Pump'
              inlet_node_name: '{} Supply Inlet'
              outlet_node_name: '{} Supply Inlet Pump Outlet'
              design_flow_rate: Autosize
              design_power_consumption: Autosize
              pump_control_type: Intermittent
              Transitions:
                hot_water_pump_rated_head: design_pump_head
          - Branch:
              name: '{} Supply Inlet Branch'
              components:
                - component_object_type: Pump:ConstantSpeed
                  component_name: '{} Supply Pump'
                  component_inlet_node_name: '{} Supply Inlet'
                  component_outlet_node_name: '{} Supply Inlet Pump Outlet'
          - Pipe:Adiabatic:
              name: '{} Supply Bypass Pipe'
              inlet_node_name: '{} Supply Bypass Inlet'
              outlet_node_name: '{} Supply Bypass Outlet'
          - Branch:
              name: '{} Supply Bypass Branch'
              components:
                - component_object_type: Pipe:Adiabatic
                  component_name: '{} Supply Bypass Pipe'
                  component_inlet_node_name: '{} Supply Bypass Inlet'
                  component_outlet_node_name: '{} Supply Bypass Outlet'
          - Pipe:Adiabatic:
              name: '{} Supply Outlet Pipe'
              inlet_node_name: '{} Supply Outlet Pipe Inlet'
              outlet_node_name: '{} Supply Outlet'
          - Branch:
              name: '{} Supply Outlet Branch'
              components:
                - component_object_type: Pipe:Adiabatic
                  component_name: '{} Supply Outlet Pipe'
                  component_inlet_node_name: '{} Supply Outlet Pipe Inlet'
                  component_outlet_node_name: '{} Supply Outlet'
          - Pipe:Adiabatic:
              name: '{} Demand Inlet Pipe'
              inlet_node_name: '{} Demand Inlet'
              outlet_node_name: '{} Demand Inlet Pipe Outlet'
          - Branch:
              name: '{} Demand Inlet Branch'
              components:
                - component_object_type: Pipe:Adiabatic
                  component_name: '{} Demand Inlet Pipe'
                  component_inlet_node_name: '{} Demand Inlet'
                  component_outlet_node_name: '{} Demand Inlet Pipe Outlet'
          - Pipe:Adiabatic:
              name: '{} Demand Bypass Pipe'
              inlet_node_name: '{} Demand Bypass Inlet'
              outlet_node_name: '{} Demand Bypass Outlet'
          - Branch:
              name: '{} Demand Bypass Branch'
              components:
                - component_object_type: Pipe:Adiabatic
                  component_name: '{} Demand Bypass Pipe'
                  component_inlet_node_name: '{} Demand Bypass Inlet'
                  component_outlet_node_name: '{} Demand Bypass Outlet'
          - Pipe:Adiabatic:
              name: '{} Demand Outlet Pipe'
              inlet_node_name: '{} Demand Outlet Pipe Inlet'
              outlet_node_name: '{} Demand Outlet'
          - Branch:
              name: '{} Demand Outlet Branch'
              components:
                - component_object_type: Pipe:Adiabatic
                  component_name: '{} Demand Outlet Pipe'
                  component_inlet_node_name: '{} Demand Outlet Pipe Inlet'
                  component_outlet_node_name: '{} Demand Outlet'
      Tower:
        Base: *HVACTemplatePlantTower
        AdditionalObjects:
          - Branch:
              name: '{} Cooling Tower CndW Branch'
              components:
                - component_object_type:
                    CoolingTower.*: self
                  component_name:
                    CoolingTower.*: key
                  component_inlet_node_name:
                    CoolingTower.*: water_inlet_node_name
                  component_outlet_node_name:
                    CoolingTower.*: water_outlet_node_name
          - OutdoorAir:Node:
              name:
                CoolingTower.*: outdoor_air_inlet_node_name
